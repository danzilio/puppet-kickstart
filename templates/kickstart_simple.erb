### THIS FILE WAS GENERATED BY PUPPET ###
#Centos Kickstart for net install
#version=<VERSION>

install
url <%= @url %>
lang <%= @lang %>
keyboard <%= @keyboard %>
#text
cmdline
network --onboot yes <%= @network %> <% unless @ipv6 -%>--noipv6<%- end -%> --hostname <%= @hostname %>.<%= @domain %>
rootpw <%- if @rootpw_iscrypted -%>--iscrypted <%- end -%><%= @rootpw %>
firewall <%= @firewall %>
authconfig <%= @authconfig %>
selinux <%= @selinux_mode %>
timezone <%= @timezone %>
bootloader <%= @bootloader_location %> --driveorder=sda --append="crashkernel=auto rhgb quiet"

<% if @partition_configuration && ! @partition_configuration.empty? -%>
# Partition Configuration
  <%- @partition_configuration.each do |command,arguments| -%>
    <%- if arguments.is_a?(Array) -%>
      <%- arguments.each do |arg| -%>
<%= command %> <%= arg %>
      <%- end -%>
    <%- elsif arguments == true -%>
<%= command %>
    <%- else -%>
<%= command %> <%= arguments %>
    <%- end -%>
  <%- end -%>
<%- else -%>
zerombr
clearpart --all --drives=sda --initlabel

part /boot --fstype=ext4 --size=500
part pv.008002 --grow --size=200

volgroup <%= @volgroup %> --pesize=4096 pv.008002
logvol /home --fstype=ext4 --name=lv_home --vgname=<%= @volgroup %> --size=15000
logvol / --fstype=ext4 --name=lv_root --vgname=<%= @volgroup %> --size=5000
logvol swap --name=lv_swap --vgname=<%= @volgroup %> --size=4096
logvol /usr --fstype=ext4 --name=lv_usr --vgname=<%= @volgroup %> --size=15000
logvol /var --fstype=ext4 --name=lv_var --vgname=<%= @volgroup %> --size=15000
<% end -%>

<%- @repos.each do |name, repo| -%>
repo --name <%= name %> <%= repo.map { |option, param| "--#{option} #{param}" }.join(' ') %>
<% end -%>

%packages --nobase
# Add these
<%- @packages_to_add.each do |package| -%>
<%= package %>
<%- end -%>

# Remove these
<%- @packages_to_remove.each do |package| -%>
-<%= package %>
<% end -%>

%end

%post --log=<%= @post_log %>

<%- if @puppet_repo %>
rpm -ivh <%= @puppet_repo %>
yum -y install puppet
yum -y update

<% end -%>
chkconfig ntpd on

<%- if @image_url -%>
wget <%= @image_url %>
\cp -f issue /etc/issue
\cp -f /etc/issue /etc/issue.net
rm -rf ./issue
echo "Banner /etc/issue.net" >> /etc/ssh/sshd_config

<% end -%>
<%- if @relayhost -%>
postconf -e relayhost=<%= @relayhost %>

<% end -%>
%end

reboot
